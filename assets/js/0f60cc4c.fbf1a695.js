"use strict";(self.webpackChunksearch_party_lab=self.webpackChunksearch_party_lab||[]).push([[7478],{2673:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>p,frontMatter:()=>s,metadata:()=>l,toc:()=>u});var r=t(4848),a=t(8453),o=t(1470),i=t(9365);const s={},c="Using OpenAI",l={id:"vector-search/create-vectors/openai",title:"Using OpenAI",description:"Take-home activity! Do it if you are following along at home. It won't be covered during the hands-on lab.",source:"@site/docs/7-vector-search/5-create-vectors/2-openai.mdx",sourceDirName:"7-vector-search/5-create-vectors",slug:"/vector-search/create-vectors/openai",permalink:"/search-lab/docs/vector-search/create-vectors/openai",draft:!1,unlisted:!1,editUrl:"https://github.com/mongodb-developer/search-lab/blob/main/docs/7-vector-search/5-create-vectors/2-openai.mdx",tags:[],version:"current",sidebarPosition:2,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Using Voyage AI",permalink:"/search-lab/docs/vector-search/create-vectors/ws-voyageai"},next:{title:"Using Google Cloud Vertex AI",permalink:"/search-lab/docs/vector-search/create-vectors/google-vertex"}},d={},u=[{value:"Create an OpenAI account and get an API key",id:"create-an-openai-account-and-get-an-api-key",level:2},{value:"Create embeddings for documents",id:"create-embeddings-for-documents",level:2},{value:"Create embeddings for the books",id:"create-embeddings-for-the-books",level:2},{value:"Querying with vectors",id:"querying-with-vectors",level:2},{value:"Configuring the application",id:"configuring-the-application",level:2},{value:"Configuring the application",id:"configuring-the-application-1",level:2},{value:"Running the application",id:"running-the-application",level:2}];function h(e){const n={a:"a",admonition:"admonition",br:"br",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...e.components},{Screenshot:t}=n;return t||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Screenshot",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"using-openai",children:"Using OpenAI"})}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsx)(n.p,{children:"Take-home activity! Do it if you are following along at home. It won't be covered during the hands-on lab."})}),"\n",(0,r.jsxs)(n.p,{children:["OpenAI is a company that develops AI models for natural language processing. They offer a free API that you can use to create embeddings for your documents. The API is called ",(0,r.jsx)(n.a,{href:"https://platform.openai.com/docs/api-reference/embeddings",children:"OpenAI's Embedding API"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"To get some embeddings using their API, you need to create an account and get an API key."}),"\n",(0,r.jsx)(n.h2,{id:"create-an-openai-account-and-get-an-api-key",children:"Create an OpenAI account and get an API key"}),"\n",(0,r.jsxs)(n.p,{children:["To create an account, go to ",(0,r.jsx)(n.a,{href:"http://openai.com/",children:"https://openai.com/"})," and click on the ",(0,r.jsx)(n.strong,{children:"Log In"})," button in the upper right corner. This will redirect you to the login page, where you'll have the option to sign up for their services."]}),"\n",(0,r.jsx)(t,{src:"img/screenshots/7-vector-search/5-create-vectors/3-openai/1-signup.png",url:"https://openai.com/",alt:"The OpenAI signup page"}),"\n",(0,r.jsx)(n.p,{children:"Follow the instructions on the screen, and verify your email address."}),"\n",(0,r.jsxs)(n.p,{children:["Once you have an account, you can go to the ",(0,r.jsx)(n.a,{href:"https://platform.openai.com/account/api-keys",children:"API keys page"})," to get an API key."]}),"\n",(0,r.jsxs)(n.p,{children:["From there, click on the ",(0,r.jsx)(n.strong,{children:"Create new secret key"})," button."]}),"\n",(0,r.jsx)(t,{src:"img/screenshots/7-vector-search/5-create-vectors/3-openai/2-create-key.png",url:"https://platform.openai.com/account/api-keys",alt:"The OpenAI API keys page"}),"\n",(0,r.jsxs)(n.p,{children:['You\'ll be prompted to give your key a name. You can call it "MongoDB Vector Search Demo." Click on the ',(0,r.jsx)(n.strong,{children:"Create secret key"})," button."]}),"\n",(0,r.jsx)(n.p,{children:"You will then be presented with your API key. Copy it and save it somewhere safe."}),"\n",(0,r.jsx)(t,{src:"img/screenshots/7-vector-search/5-create-vectors/3-openai/3-api-key.png",url:"https://platform.openai.com/account/api-keys",alt:"The OpenAI API key"}),"\n",(0,r.jsx)(n.admonition,{type:"caution",children:(0,r.jsx)(n.p,{children:"Make sure you copy this key somewhere as you'll need it later on, and you won't be able to see it again."})}),"\n",(0,r.jsx)(n.p,{children:"Now that you have an API key, you can use it to create embeddings for your documents."}),"\n",(0,r.jsx)(n.h2,{id:"create-embeddings-for-documents",children:"Create embeddings for documents"}),"\n",(0,r.jsx)(n.p,{children:"To create embeddings for your documents by sending curl commands to the OpenAI API, you can use the following command."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'OPENAI_API_KEY=<YOUR_API_KEY>\ncurl https://api.openai.com/v1/embeddings \\\n  -H "Authorization: Bearer $OPENAI_API_KEY" \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "input": "The food was delicious and the waiter...",\n    "model": "text-embedding-ada-002"\n  }\'\n'})}),"\n",(0,r.jsxs)(n.p,{children:["You can find more information about the API in the ",(0,r.jsx)(n.a,{href:"https://platform.openai.com/docs/api-reference/embeddings",children:"OpenAI documentation"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"create-embeddings-for-the-books",children:"Create embeddings for the books"}),"\n",(0,r.jsx)(n.p,{children:"To create the embeddings for the books in your collection, you should run this curl command, or use the Node.js library, for each book. This process is somewhat time-consuming, so we've already created them for you."}),"\n",(0,r.jsxs)(n.p,{children:["You can find the 1586 dimensions vector in the ",(0,r.jsx)(n.code,{children:"embeddings"})," field of the books."]}),"\n",(0,r.jsx)(n.p,{children:"Because we already have the vectors for the books, we can use them with Vector Search."}),"\n",(0,r.jsx)(n.h2,{id:"querying-with-vectors",children:"Querying with vectors"}),"\n",(0,r.jsx)(n.p,{children:"To query the data, Vector Search will need to calculate the distance between the query vector and the vectors of the documents in the collection."}),"\n",(0,r.jsx)(n.p,{children:"To do so, you will need to vectorize your query. You can use the same function to vectorize your query, as well."}),"\n",(0,r.jsxs)(o.A,{groupId:"server",children:[(0,r.jsxs)(i.A,{value:"node",label:"\ud83d\ude80 NodeJS/Express",children:[(0,r.jsxs)(n.p,{children:["In the library application, we've created a function that will vectorize your query for you. You can find it in the ",(0,r.jsx)(n.code,{children:"server/src/embeddings/openai.ts"})," file."]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"import OpenAI from 'openai';\n\nconst { EMBEDDING_KEY } = process.env;\n\nlet openai;\n\nconst getTermEmbeddings = async (text) => {\n    if (!openai) {\n        openai = new OpenAI({apiKey: EMBEDDING_KEY});\n    }\n    const embeddings = await openai.embeddings.create({\n        model: 'text-embedding-ada-002',\n        input: text,\n    });\n    return embeddings?.data[0]?.embedding;\n};\n\nexport default getTermEmbeddings;\n"})}),(0,r.jsx)(n.h2,{id:"configuring-the-application",children:"Configuring the application"}),(0,r.jsxs)(n.p,{children:["In your ",(0,r.jsx)(n.code,{children:"server/.env"})," file, you'll find a few variables that you can use to configure the application."]}),(0,r.jsxs)(n.p,{children:["The first one is ",(0,r.jsx)(n.code,{children:"EMBEDDINGS_SOURCE"}),". It tells the application where to get the embeddings from. You can set it to ",(0,r.jsx)(n.code,{children:"openai"}),"."]}),(0,r.jsxs)(n.p,{children:["Now that you have an OpenAI API key, you can set the ",(0,r.jsx)(n.code,{children:"EMBEDDING_KEY"})," variable to your API key."]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"EMBEDDINGS_SOURCE=openai\nEMBEDDING_KEY=sk-...\n"})})]}),(0,r.jsxs)(i.A,{value:"java",label:"\u2615\ufe0f Java Spring Boot",children:[(0,r.jsxs)(n.p,{children:["To run semantic queries in Java, the application also needs to generate embeddings for your query.",(0,r.jsx)(n.br,{}),"\n","This is handled by the ",(0,r.jsx)(n.a,{href:"https://github.com/mongodb-developer/library-management-system/blob/java-server/java-server/src/main/java/com/mongodb/devrel/library/domain/provider/EmbeddingProvider.java",children:(0,r.jsx)(n.code,{children:"EmbeddingProvider"})})," interface.   For OpenAI, the implementation is ",(0,r.jsx)(n.a,{href:"https://github.com/mongodb-developer/library-management-system/blob/java-server/java-server/src/main/java/com/mongodb/devrel/library/infrastructure/provider/OpenAIEmbeddingProvider.java",children:(0,r.jsx)(n.code,{children:"OpenAIEmbeddingProvider"})}),", which delegates the HTTP call to the Feign client:"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",metastring:"title='src/main/java/com/mongodb/devrel/library/infrastructure/embeddings/openai/OpenAIEmbeddingClient.java'",children:'@FeignClient(\n    name = "openai-embeddings",\n    url = "${openai.base-url}",\n    configuration = OpenAIFeignInterceptor.class\n)\npublic interface OpenAIEmbeddingClient {\n    @PostMapping(\n            value = "/v1/embeddings", \n            consumes = "application/json", \n            produces = "application/json"\n    )\n    OpenAIEmbeddingResponse createEmbeddings(@RequestBody OpenAIEmbeddingRequest request);\n}\n'})}),(0,r.jsx)(n.h2,{id:"configuring-the-application-1",children:"Configuring the application"}),(0,r.jsxs)(n.p,{children:["To use OpenAI, you only need to adjust two parameters in ",(0,r.jsx)(n.code,{children:"application.yml"}),":"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yml",metastring:"title='src/main/resources/application.yml'",children:"embeddings:\n  source: ${EMBEDDING_SOURCE}\n\nopenai:\n  api-key: ${OPENAI_KEY:yourKey}\n"})}),(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"embeddings.source"})," property is what selects the provider at runtime.\nIf you set it to openai, the OpenAI implementation will be used."]}),(0,r.jsx)(n.p,{children:"You can either edit these values in application.yml, or export them as environment variables:"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"export EMBEDDING_SOURCE=openai\nexport OPENAI_KEY=sk-...\n"})}),(0,r.jsx)(n.h2,{id:"running-the-application",children:"Running the application"}),(0,r.jsx)(n.p,{children:"Once the variables are set, start the application as usual:"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"mvn spring-boot:run\n"})}),(0,r.jsxs)(n.p,{children:["At the end, when the application starts, just make a call to ",(0,r.jsx)(n.code,{children:"searchBooks"})," as\ndescribed in the step ",(0,r.jsx)(n.a,{href:"http://localhost:3000/search-lab/docs/vector-search/add-to-app",children:"Add Semantic Search to Your Application"}),"\nand you will see the application calling the ",(0,r.jsx)(n.strong,{children:"OPENAI"})," implementation:"]}),(0,r.jsx)(t,{src:"/img/screenshots/7-vector-search/5-create-vectors/3-openai/4-checking-logs.png",url:"https://cloud.google.com"})]})]})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},9365:(e,n,t)=>{t.d(n,{A:()=>i});t(6540);var r=t(8215);const a={tabItem:"tabItem_Ymn6"};var o=t(4848);function i(e){let{children:n,hidden:t,className:i}=e;return(0,o.jsx)("div",{role:"tabpanel",className:(0,r.A)(a.tabItem,i),hidden:t,children:n})}},1470:(e,n,t)=>{t.d(n,{A:()=>I});var r=t(6540),a=t(8215),o=t(3104),i=t(6347),s=t(205),c=t(7485),l=t(1682),d=t(679);function u(e){return r.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(e){const{values:n,children:t}=e;return(0,r.useMemo)((()=>{const e=n??function(e){return u(e).map((e=>{let{props:{value:n,label:t,attributes:r,default:a}}=e;return{value:n,label:t,attributes:r,default:a}}))}(t);return function(e){const n=(0,l.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,t])}function p(e){let{value:n,tabValues:t}=e;return t.some((e=>e.value===n))}function m(e){let{queryString:n=!1,groupId:t}=e;const a=(0,i.W6)(),o=function(e){let{queryString:n=!1,groupId:t}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:n,groupId:t});return[(0,c.aZ)(o),(0,r.useCallback)((e=>{if(!o)return;const n=new URLSearchParams(a.location.search);n.set(o,e),a.replace({...a.location,search:n.toString()})}),[o,a])]}function g(e){const{defaultValue:n,queryString:t=!1,groupId:a}=e,o=h(e),[i,c]=(0,r.useState)((()=>function(e){let{defaultValue:n,tabValues:t}=e;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!p({value:n,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const r=t.find((e=>e.default))??t[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:n,tabValues:o}))),[l,u]=m({queryString:t,groupId:a}),[g,b]=function(e){let{groupId:n}=e;const t=function(e){return e?`docusaurus.tab.${e}`:null}(n),[a,o]=(0,d.Dv)(t);return[a,(0,r.useCallback)((e=>{t&&o.set(e)}),[t,o])]}({groupId:a}),v=(()=>{const e=l??g;return p({value:e,tabValues:o})?e:null})();(0,s.A)((()=>{v&&c(v)}),[v]);return{selectedValue:i,selectValue:(0,r.useCallback)((e=>{if(!p({value:e,tabValues:o}))throw new Error(`Can't select invalid tab value=${e}`);c(e),u(e),b(e)}),[u,b,o]),tabValues:o}}var b=t(2303);const v={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var f=t(4848);function y(e){let{className:n,block:t,selectedValue:r,selectValue:i,tabValues:s}=e;const c=[],{blockElementScrollPositionUntilNextRender:l}=(0,o.a_)(),d=e=>{const n=e.currentTarget,t=c.indexOf(n),a=s[t].value;a!==r&&(l(n),i(a))},u=e=>{let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const t=c.indexOf(e.currentTarget)+1;n=c[t]??c[0];break}case"ArrowLeft":{const t=c.indexOf(e.currentTarget)-1;n=c[t]??c[c.length-1];break}}n?.focus()};return(0,f.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.A)("tabs",{"tabs--block":t},n),children:s.map((e=>{let{value:n,label:t,attributes:o}=e;return(0,f.jsx)("li",{role:"tab",tabIndex:r===n?0:-1,"aria-selected":r===n,ref:e=>c.push(e),onKeyDown:u,onClick:d,...o,className:(0,a.A)("tabs__item",v.tabItem,o?.className,{"tabs__item--active":r===n}),children:t??n},n)}))})}function x(e){let{lazy:n,children:t,selectedValue:o}=e;const i=(Array.isArray(t)?t:[t]).filter(Boolean);if(n){const e=i.find((e=>e.props.value===o));return e?(0,r.cloneElement)(e,{className:(0,a.A)("margin-top--md",e.props.className)}):null}return(0,f.jsx)("div",{className:"margin-top--md",children:i.map(((e,n)=>(0,r.cloneElement)(e,{key:n,hidden:e.props.value!==o})))})}function j(e){const n=g(e);return(0,f.jsxs)("div",{className:(0,a.A)("tabs-container",v.tabList),children:[(0,f.jsx)(y,{...n,...e}),(0,f.jsx)(x,{...n,...e})]})}function I(e){const n=(0,b.A)();return(0,f.jsx)(j,{...e,children:u(e.children)},String(n))}},8453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>s});var r=t(6540);const a={},o=r.createContext(a);function i(e){const n=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);